CREATE OR REPLACE VIEW DEV_DB.DECKS_RAW.V_SAC_MPR_SNS AS

    WITH cte AS (
        
        -- Selecting KPI_IDs of KPIs to be transposed into measures, combining KPI_ID and DATA_TYPE into one column SAC_KPI_KEY_1
        SELECT SLS_MKT_PARENT_ID, SLS_MKT_PARENT_DESC, SLS_MKT_ID, SLS_MKT_DESC, MRU_ID, MRU_DESC, ORU_ID, ORU_DESC, TYPE, YEARS, MONTHS, CURRENCY,
        SAC_CLOSURE_DATE_ID, SAC_CLOSURE_DATE_DESC, SAC_AUTHORIZATION, SAC_COLUMN_ID, SAC_COLUMN_DESC, SAC_C1_ID, SAC_C1_DESC, SAC_C2_ID, SAC_C2_DESC,
        CONCAT(SAC_KPI_ID,' ',DATA_TYPE) AS SAC_KPI_KEY_1, SAC_OBJECT_ID, SAC_OBJECT_DESC, 
        '99999999' AS SAC_KPI_ID, 'SAC_Account' AS SAC_KPI_DESC,
        VALUE
        FROM DEV_DB.DECKS_RAW.T_SAC_FC_CONVENTIONAL
        WHERE SAC_KPI_ID IN (50030010, 50030020, 50030030, 50020010, 50020020, 50020030, 50010010, 50010020, 50010030, 50010040, 50060010, 50060020, 50060030, 50060040)

    )

        -- Pivotting SAC_KPI_KEY_1 to different measures
    SELECT 'Miscellaneous' AS KPI_ID, SLS_MKT_PARENT_ID, SLS_MKT_PARENT_DESC, SLS_MKT_ID, SLS_MKT_DESC, MRU_ID, MRU_DESC, ORU_ID, ORU_DESC, 
        'Miscellaneous' AS DATA_TYPE, TYPE, YEARS, MONTHS, CURRENCY, SAC_CLOSURE_DATE_ID, SAC_CLOSURE_DATE_DESC, SAC_AUTHORIZATION, SAC_OBJECT_ID, SAC_OBJECT_DESC, 
        NULL AS SAC_KPI_PARENT_ID, SAC_KPI_ID, SAC_KPI_DESC, SAC_COLUMN_ID, SAC_COLUMN_DESC, NULL AS SAC_HIERARCHY_LVL, SAC_C1_ID, SAC_C1_DESC, SAC_C2_ID, SAC_C2_DESC,
        NULL AS TEXT1, NULL AS TEXT2, NULL AS VALUE,
        "'50030010 Actual'" AS SNS_SALES_PROJ_CHART_ORDERBOOK,
        "'50030020 Actual'" AS SNS_SALES_PROJ_CHART_ACTUAL,
        "'50030020 Target'" AS SNS_SALES_PROJ_CHART_TARGET, 
        "'50030030 Actual'" AS SNS_SALES_PROJ_CHART_WEIGHTED_FUNNEL,
        "'50020010 Actual'" AS SNS_FUNNEL_CHART_WEIGHTED,
        "'50020020 Actual'" AS SNS_FUNNEL_CHART_UNWEIGHTED, 
        "'50020030 Actual'" AS SNS_FUNNEL_CHART_MAT_WIN_RATE,
        "'50010010 Actual'" AS SNS_AVERAGE_VISIT_CHART_ADOPTION,
        "'50010020 Actual'" AS SNS_AVERAGE_VISIT_CHART_AVG_VISIT_MAX,
        "'50010030 Actual'" AS SNS_AVERAGE_VISIT_CHART_AVG_VISIT_MIN, 
        "'50010040 Actual'" AS SNS_AVERAGE_VISIT_CHART_AVG_VISIT,
        "'50060010 Actual'" AS SNS_PROJ_COMMIT_DATE_ACCURACY_CHART_INPUT_PROBLEM,
        "'50060020 Actual'" AS SNS_PROJ_COMMIT_DATE_ACCURACY_CHART_DELAYED,
        "'50060030 Actual'" AS SNS_PROJ_COMMIT_DATE_ACCURACY_CHART_PULLED_IN, 
        "'50060040 Actual'" AS SNS_PROJ_COMMIT_DATE_ACCURACY_CHART_OUTPUT_CORRECT,
        "'50070010 Actual'" AS SNS_CUSTOMER_NPS_CHART_ITQ_NPS,
        "'50070020 Actual'" AS SNS_CUSTOMER_NPS_CHART_MAT_NPS,
    FROM cte 
    PIVOT ( MAX(VALUE) FOR SAC_KPI_KEY_1 IN ('50030010 Actual', '50030020 Actual', '50030020 Target', '50030030 Actual', '50020010 Actual', '50020020 Actual', '50020030 Actual',
        '50010010 Actual', '50010020 Actual', '50010030 Actual', '50010040 Actual', '50060010 Actual', '50060020 Actual', '50060030 Actual', '50060040 Actual', '50070010 Actual', '50070020 Actual')
    );